package heyday

/*

   Methods of Chromatic Adaptation

   sources:
       http://www.brucelindbloom.com/index.html?Eqn_ChromAdapt.html
       http://hrcak.srce.hr/file/95370
       http://play.golang.org/p/rRbBdVgT0j
       http://play.golang.org/p/bVgaCMfi52
       http://web.stanford.edu/~sujason/ColorBalancing/adaptation.html
       http://play.golang.org/p/gM5Hp7bzl1

    // Now turn off word-wrap

          CAT     |              [Ma]             |            [Mₐ]⁻¹
   ---------------+-------------------------------+-------------------------------------------------------------------------
                  |  [  1.0000  0.0000  0.0000 ]  |  [  1.0000  0.0000  0.0000 ]
     XYZ Scaling  |  [  0.0000  1.0000  0.0000 ]  |  [  0.0000  1.0000  0.0000 ]
                  |  [  0.0000  0.0000  1.0000 ]  |  [  0.0000  0.0000  1.0000 ]
   ---------------+-------------------------------+-------------------------------------------------------------------------
                  |  [  0.8951  0.2664 -0.1614 ]  |  [  0.986992905466712100 -0.147054256420990100  0.159962651663731220 ]
      Bradford    |  [ -0.7502  1.7135  0.0367 ]  |  [  0.432305269723394500  0.518360271536777600  0.049291228212855594 ]
                  |  [  0.0389  0.0685  1.0296 ]  |  [ -0.008528664575177328  0.040042821654084860  0.968486695787550000 ]
   ---------------+-------------------------------+-------------------------------------------------------------------------
                  |  [  0.4002  0.7076 -0.0808 ]  |  [  1.859936387455839700 -1.129381618580091600  0.219897409596193280 ]
      Von Kries   |  [ -0.2263  1.1653  0.0457 ]  |  [  0.361191436241767600  0.638812463285042200 -0.000006370596838651 ]
                  |  [  0.0000  0.0000  0.9182 ]  |  [ -0.000000000000000000 -0.000000000000000000  1.089063623096861300 ]
   ---------------+-------------------------------+-------------------------------------------------------------------------
                  |  [  0.8951 -0.7502  0.0389 ]  |  [  0.977582533226663700  0.429405537812052900 -0.065503340989357840 ]
       CMCCAT97   |  [  0.2664  1.7135  0.0685 ]  |  [ -0.158337864212157560  0.514883316879461800 -0.028273275338374315 ]
                  |  [ -0.1614  0.0367  1.0296 ]  |  [  0.158889685780273570  0.048960602246881375  0.961990471998092400 ]
   ---------------+-------------------------------+-------------------------------------------------------------------------
                  |  [  0.7982  0.3389 -0.1371 ]  |  [  1.076450048678639700 -0.237662388092563040  0.1612123394139235000 ]
      CMCCAT2000  |  [ -0.5918  1.5512  0.0406 ]  |  [  0.410964325479775900  0.554341804147103200  0.0346938703731209900 ]
                  |  [  0.0008  0.0239  0.9753 ]  |  [ -0.010953765423879379 -0.013389356309486022  1.0243431217333656000 ]
   ---------------+-------------------------------+-------------------------------------------------------------------------
                  |  [  1.2694 -0.0988 -0.1706 ]  |  [  0.815633309578485000  0.047154778817851280  0.1372166270815455000 ]
        Sharp     |  [ -0.8364  1.8006  0.0357 ]  |  [  0.379114399111020500  0.576942424774199000  0.0440008703572581400 ]
                  |  [  0.0297 -0.0315  1.0018 ]  |  [ -0.012260137475028810  0.016743051955976328  0.9955187598242481000 ]
   ---------------+-------------------------------+-------------------------------------------------------------------------
                  |  [  0.7328  0.4296 -0.1624 ]  |  [  1.096123820835514400 -0.278869000218287300  0.1827451793827731000 ]
        CAT02     |  [ -0.7036  1.6975  0.0061 ]  |  [  0.454369041975359300  0.473533154307411900  0.0720978037172291300 ]
                  |  [  0.0030  0.0136  0.9834 ]  |  [ -0.009627608738429355 -0.005698031216113421  1.0153256399545430000 ]
   ---------------+-------------------------------+-------------------------------------------------------------------------
*/

// Methods of Chromatic Adaptation

const (
	XYZScaling int = iota
	Bradford
	VonKries
	CMCCAT97
	CMCCAT2000
	Sharp
	CAT02
)

// Chromatic Adaptetion Marixes
// Direct and Inverse
// Inverse matrices are precomputed for perfomance gain
// There are four methods (exclusive XYZ Scale), but you can use your own matrices for chromatic adaptation

type Camx struct {
	Direct,
	Inverse Matrix3x3
}

// cromatic adaptation matrices

var camx = [7]Camx{
	// XYZ Scaling matrices
	Camx{
		Matrix3x3{ // direct
			1, 0, 0,
			0, 1, 0,
			0, 0, 1,
		},
		Matrix3x3{ // inverse
			1, 0, 0,
			0, 1, 0,
			0, 0, 1,
		},
	},
	// Bradford
	Camx{
		Matrix3x3{
			0.8951, 0.2664, -0.1614,
			-0.7502, 1.7135, 0.0367,
			0.0389, 0.0685, 1.0296,
		},
		Matrix3x3{
			0.986992905466712100, -0.147054256420990100, 0.159962651663731220,
			0.432305269723394500, 0.518360271536777600, 0.049291228212855594,
			0.008528664575177328, 0.040042821654084860, 0.968486695787550000,
		},
	},
	// Von Kries
	Camx{
		Matrix3x3{
			0.4002, 0.7076, -0.0808,
			-0.2263, 1.1653, 0.0457,
			0.0000, 0.0000, 0.9182,
		},
		Matrix3x3{
			1.859936387455839700, -1.129381618580091600, 0.219897409596193280,
			0.361191436241767600, 0.638812463285042200, -0.000006370596838651,
			-0.000000000000000000, -0.000000000000000000, 1.089063623096861300,
		},
	},
	// CMCCAT97
	Camx{
		Matrix3x3{
			0.8951, -0.7502, 0.0389,
			0.2664, 1.7135, 0.0685,
			-0.1614, 0.0367, 1.0296,
		},
		Matrix3x3{
			0.977582533226663700, 0.429405537812052900, -0.065503340989357840,
			-0.158337864212157560, 0.514883316879461800, -0.028273275338374315,
			0.158889685780273570, 0.048960602246881375, 0.961990471998092400,
		},
	},
	// CMCCAT2000
	Camx{
		Matrix3x3{
			0.7982, 0.3389, -0.1371,
			-0.5918, 1.5512, 0.0406,
			0.0008, 0.0239, 0.9753,
		},
		Matrix3x3{
			1.076450048678639700, -0.237662388092563040, 0.1612123394139235000,
			0.410964325479775900, 0.554341804147103200, 0.0346938703731209900,
			-0.010953765423879379, -0.013389356309486022, 1.0243431217333656000,
		},
	},
	// Sharp
	Camx{
		Matrix3x3{
			1.2694, -0.0988, -0.1706,
			-.8364, 1.8006, 0.0357,
			0.0297, -0.0315, 1.0018,
		},
		Matrix3x3{
			0.815633309578485000, 0.047154778817851280, 0.1372166270815455000,
			0.379114399111020500, 0.576942424774199000, 0.0440008703572581400,
			-0.012260137475028810, 0.016743051955976328, 0.9955187598242481000,
		},
	},
	// CAT02
	Camx{
		Matrix3x3{
			0.7328, 0.4296, -0.1624,
			-0.7036, 1.6975, 0.0061,
			0.0030, 0.0136, 0.9834,
		},
		Matrix3x3{
			1.096123820835514400, -0.278869000218287300, 0.1827451793827731000,
			0.454369041975359300, 0.473533154307411900, 0.0720978037172291300,
			-0.009627608738429355, -0.005698031216113421, 1.0153256399545430000,
		},
	},
}

func CaMethod(a11, b11, c11, a21, b21, c21, a22, b22, c22 float64) (*Camx, error) {
	t := new(Camx)
	var err error
	t.Direct.Set(a11, b11, c11, a21, b21, c21, a22, b22, c22)
	t.Inverse, err = t.Direct.Inverse()
	return t, err
}

// create your own chromatic adaptation method
// it is matrix 3x3, the inverse matrix will be set automatically
// if you want to set direct and inverse matrix manualy,
// create *Camx and use it. for example:
//  ca := new(Camx)
//  ca.Direct.Set(1,2,...)
//  ca.Inverse.Set(0,3,...)
// An error may occur if inverse matrix of Direct doesn't exist
// ref.: http://www.brucelindbloom.com/index.html?Eqn_ChromAdapt.html
//       see about [Ma] and [Ma]-1 matrices
